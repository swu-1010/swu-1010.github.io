"use strict";(self["webpackChunkbookstore_app"]=self["webpackChunkbookstore_app"]||[]).push([[146],{73146:function(t,e,o){o.r(e),o.d(e,{default:function(){return h}});var a=function(){var t=this,e=t._self._c;return e("div",{staticClass:"cart"},[e("van-nav-bar",{attrs:{"left-arrow":"",title:"购物车"},on:{"click-left":function(e){return t.$router.back(-1)}}},[t.isManage?e("span",{attrs:{slot:"right"},on:{click:function(e){return t.manage()}},slot:"right"},[t._v("退出管理")]):e("van-icon",{attrs:{slot:"right",name:"ellipsis"},on:{click:function(e){return t.manage()}},slot:"right"})],1),""==this.$store.getters.getCartNum?e("van-notice-bar",[t._v("您的购物车空空如也...")]):t._e(),e("div",{staticClass:"content"},t._l(t.shopCarts,(function(o,a){return e("div",{key:a},[e("div",{staticClass:"publish"},[e("nav",[t._v(t._s(o.publisher))])]),t._l(o.books,(function(o,a){return e("van-card",{key:a,attrs:{price:o.price,desc:o.author,title:o.name,thumb:"/"+o.img},on:{click:function(e){return t.toDetail(o.bookId)}},scopedSlots:t._u([{key:"tag",fn:function(){return[e("van-checkbox",{nativeOn:{click:function(e){return t.updateCart(o.bookId,0)}},model:{value:o.checked,callback:function(e){t.$set(o,"checked",e)},expression:"book.checked"}})]},proxy:!0},{key:"num",fn:function(){return[e("van-icon",{attrs:{name:"delete-o"},on:{click:function(e){return t.deleteCart(o.bookId)}}})]},proxy:!0},{key:"footer",fn:function(){return[e("van-stepper",{attrs:{theme:"round",value:o.num},on:{plus:function(e){return t.addNum(o.bookId)},minus:function(e){return t.subNum(o.bookId)}}})]},proxy:!0}],null,!0)})}))],2)})),0),this.isManage?e("van-submit-bar",{attrs:{"button-text":"删除",disabled:t.isCheckCart},on:{submit:function(e){return t.deleteCarts()}}},[e("van-checkbox",{staticStyle:{width:"70%"},nativeOn:{click:function(e){return t.updateCart(0,1)}},model:{value:t.allCheck,callback:function(e){t.allCheck=e},expression:"allCheck"}},[t._v("全选")])],1):e("van-submit-bar",{attrs:{price:t.totalPrice,disabled:t.isCheckCart,"button-text":"结算"},on:{submit:function(e){return t.submit(t.totalPrice)}}},[e("van-checkbox",{nativeOn:{click:function(e){return t.updateCart(0,1)}},model:{value:t.allCheck,callback:function(e){t.allCheck=e},expression:"allCheck"}},[t._v("全选")])],1)],1)},n=[],s=(o(16743),o(88848)),r=(o(57658),o(7877)),c={inject:["reload"],name:"cart",data:function(){return{books:[],ids:[],carts:[],shopCarts:[],allCheck:"",isManage:!1}},computed:{totalPrice:function(){let t=0;return this.books.forEach((e=>{1==e.checked&&(t+=e.num*e.price*100)})),t},isCheckCart:function(){let t=!0;return this.books.forEach((e=>{1!=e.checked&&1!=e.checked||(t=!1)})),t}},methods:{addNum(t){event.stopPropagation(),r.Z.add("/cart/addById",t).then((function(t){}))},subNum(t){event.stopPropagation(),r.Z.sub("/cart/subById",t).then((function(t){}))},checkAll(){let t=0;for(var e of this.books){if(0==e.checked){this.allCheck=!1;break}t++,t==this.books.length&&(this.allCheck=!0)}},updateCart(t,e){event.stopPropagation();let o=this;0==e?r.Z.updateByIds("/cart/updateByIds",t).then((t=>{o.checkAll()})):1==e&&r.Z.updateByIds("/cart/updateByIds",this.ids.join(",")).then((t=>{o.getCart(),o.checkAll()}))},deleteCart(t){let e=this;event.stopPropagation(),console.log(t),this.$dialog.confirm({title:"删除商品",message:"确认删除吗？"}).then((()=>{r.Z.deleteByIds("/cart/deleteByIds",t).then((t=>{console.log(t.data),e.getCart(),e.reload()}))})).catch((t=>{console.log(t)}))},deleteCarts(){let t=[];this.books.forEach((e=>{1==e.checked&&t.push(e.bookId)})),console.log(t),this.deleteCart(t.join(","))},toDetail(t){this.$router.push({path:"/detail",query:{id:t}})},getCarts(t){let e=[];t.forEach((t=>{e.push(t.publisher)})),e=Array.from(new Set(e));let o=[];for(let a=0;a<e.length;a++){o.push({publisher:e[a],books:[]});let n=[];t.forEach((t=>{t.publisher==e[a]&&n.push(t)})),o[a].books=n}return o},getCart(){let t=this;r.Z.getUser("/user/getUser",localStorage.getItem("username")).then((function(e){200==e.statusCode?r.Z.getBooksByUserId("/cart/getByUserId",e.data.user.id).then((function(e){t.books=[],t.carts=[],e.data&&(t.carts=e.data,t.ids=[],t.carts.forEach((e=>{t.ids.push(e.bookId)})),r.Z.getCartBookByIds("/book/getBookByIds",t.ids.join(",")).then((function(e){t.books=t.carts.map(((t,o)=>({...t,...e.data[o]}))),t.shopCarts=t.getCarts(t.books),t.checkAll(),console.log(t.shopCarts)})))})):401==e.statusCode&&((0,s.Z)("token过期"),t.$router.push("login"))}))},manage(){this.isManage=!this.isManage},submit(t){let e=[];this.books.forEach((t=>{1!=t.checked&&1!=t.checked||e.push(t)})),this.$router.push({path:"/confirmOrder",query:{books:this.getCarts(e),totalPrice:t}})}},mounted:function(){localStorage.getItem("username")&&(this.getCart(),this.$store.dispatch("setCartNum"),this.checkAll())}},i=c,l=o(43736),u=(0,l.Z)(i,a,n,!1,null,"53c17f9f",null),h=u.exports}}]);
//# sourceMappingURL=146.8b57dfda.js.map