"use strict";(self["webpackChunkbookstore_app"]=self["webpackChunkbookstore_app"]||[]).push([[334],{78334:function(e,t,s){s.r(t),s.d(t,{default:function(){return h}});var a=function(){var e=this,t=e._self._c;return t("div",{staticClass:"ConfirmOrder"},[t("van-nav-bar",{attrs:{"left-text":"确认订单","left-arrow":""},on:{"click-left":function(t){return e.$router.go(-1)}}}),t("van-address-list",{staticStyle:{padding:"0px"},attrs:{list:e.list,"default-tag-text":"默认"},on:{"click-item":function(t){return e.onAdd()}}}),e._l(e.carts,(function(s,a){return t("div",{key:a,staticStyle:{"text-align":"left"}},[t("div",{staticClass:"publish"},[t("nav",[e._v(e._s(s.publisher))])]),e._l(s.books,(function(e,s){return t("van-card",{key:s,attrs:{num:e.num,price:e.price,desc:e.author,title:e.name,thumb:"/"+e.img}})}))],2)})),t("van-action-sheet",{attrs:{"close-on-click-action":""},model:{value:e.show,callback:function(t){e.show=t},expression:"show"}},[t("template",{slot:"default"},[t("van-address-edit",{attrs:{"address-info":e.address,"area-list":e.areaList,"show-delete":"","area-columns-placeholder":["请选择","请选择","请选择"]},on:{save:e.onSave,delete:e.onDelete}})],1)],2),t("van-submit-bar",{attrs:{"suffix-label":e.totalNum,price:parseInt(e.$route.query.totalPrice),"button-text":"提交订单"},on:{submit:e.submit}})],2)},r=[],o=(s(16743),s(88848)),n=(s(57658),s(7877)),d=s(96811),l={name:"confirmOrder",data:function(){return{books:[],carts:[],user:{},show:!1,areaList:d.H,searchResult:[],address:{},list:[]}},methods:{getUser(){let e=this;n.Z.getUser("/user/getUser",localStorage.getItem("username")).then((function(t){console.log(t.data),e.user=t.data.user,e.list=[],e.list.push({name:e.user.username,tel:e.user.telephone,address:e.user.address})}))},onEdit(){this.$router.push("address")},submit(){let e=[],t=[];this.carts.forEach((s=>{s.books.forEach((s=>{e.push(s.bookId),t.push(s.num)}))})),console.log(e.join(",")),console.log(t.join(","));let s=this;this.$dialog.confirm({title:"订单结算",message:"是否付款"}).then((()=>{n.Z.addOrder("/order/add",this.$route.query.totalPrice/100,1).then((a=>{console.log(a.data);let r={orderId:a.data.id,status:2,ids:e.join(","),nums:t.join(",")};n.Z.addOrderDetail("/orderDetail/add",r).then((t=>{console.log(t.data),n.Z.deleteByIds("/cart/deleteByIds",e.join(",")).then((e=>{console.log(e.data),(0,o.Z)("成功"),s.$router.push({path:"/order",query:{status:2}})}))}))}))})).catch((()=>{n.Z.addOrder("/order/add",this.$route.query.totalPrice/100,0).then((a=>{console.log(a.data);let r={orderId:a.data.id,status:1,ids:e.join(","),nums:t.join(",")};n.Z.addOrderDetail("/orderDetail/add",r).then((t=>{console.log(t.data),n.Z.deleteByIds("/cart/deleteByIds",e.join(",")).then((e=>{console.log(e.data),(0,o.Z)("成功"),s.$store.commit("setCartNum"),s.$router.push({path:"/order",query:{status:1}})}))}))}))}))},onAdd(){this.show=!0,this.address={name:this.user.username,tel:this.user.telephone}},onSave(e){console.log(e);let t=e.province+e.city+e.county+" "+e.addressDetail;var s={telephone:e.tel,address:t};let a=this;n.Z.updateUser("/user/updateUser",s).then((function(e){console.log(e.data.data),a.user=e.data.data,a.show=!1,a.getUser()}))},onDelete(e){e.tel="",e.province="",e.name="",e.county="",e.city="",e.areaCode="",e.addressDetail=""}},created:function(){this.carts=this.$route.query.books,this.getUser()},computed:{totalNum:function(){let e=0;return this.books.forEach((t=>{e+=t.num})),e>0?"共"+e+"件":""}}},i=l,u=s(43736),c=(0,u.Z)(i,a,r,!1,null,"60d05aad",null),h=c.exports}}]);
//# sourceMappingURL=334.9b891207.js.map