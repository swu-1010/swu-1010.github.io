"use strict";(self["webpackChunkbookstore_app"]=self["webpackChunkbookstore_app"]||[]).push([[111],{59111:function(t,e,s){s.r(e),s.d(e,{default:function(){return d}});var o=function(){var t=this,e=t._self._c;return e("div",{staticClass:"order"},[e("van-nav-bar",{attrs:{"left-arrow":""},on:{"click-left":function(e){return t.back()}}},[e("van-search",{attrs:{slot:"title",placeholder:"请输入搜索关键词"},slot:"title",model:{value:t.searchValue,callback:function(e){t.searchValue=e},expression:"searchValue"}}),e("van-icon",{attrs:{slot:"right",name:"filter-o"},slot:"right"}),e("span",{staticStyle:{"margin-right":"10px"},attrs:{slot:"right"},slot:"right"},[t._v("筛选")]),e("van-icon",{attrs:{slot:"right",name:"ellipsis"},slot:"right"})],1),e("van-tabs",{attrs:{active:t.active,animated:""},on:{click:t.change}},t._l(6,(function(s){return e("van-tab",{key:s,attrs:{name:s,title:t.orderTitle(s)}},t._l(t.orders,(function(o,r){return e("div",{key:r,staticStyle:{"text-align":"left"}},[o.books[0].status==t.active-1||1==t.active||-1==o.books[0].status?e("div",{staticClass:"publish"},[e("div",{staticStyle:{float:"left"}},[t._v(t._s(o.publisher))])]):t._e(),t._l(o.books,(function(o,r){return e("div",{key:r},[o.status==t.active-1||1==t.active||-1==o.status?e("div",[e("van-card",{attrs:{num:o.num,price:o.price,desc:o.author,title:o.name,thumb:"/"+o.img},on:{click:function(e){return t.toDetail(o)}},scopedSlots:t._u([{key:"tag",fn:function(){return[e("div",{staticClass:"orderNo"},[t._v(" "+t._s("订单编号:"+o.etc.no))]),e("div",{staticClass:"orderstatus"},[t._v(t._s(t.orderStatus(o)))])]},proxy:!0},{key:"footer",fn:function(){return[2==o.status?e("van-button",{attrs:{round:"",type:"info"},on:{click:function(e){return t.cancelOrder(o.orderId,s)}}},[t._v("取消订单")]):t._e(),-2==o.status||5==o.status?e("van-button",{attrs:{round:"",type:"info"},on:{click:function(e){return t.deleteOrderDetail(o)}}},[t._v("删除订单")]):t._e(),-2!=o.status&&5!=o.status?e("van-button",{attrs:{round:"",type:"info"},on:{click:function(e){return t.action(o,o.status)}}},[t._v(t._s(t.userAction(o.status))+" ")]):t._e()]},proxy:!0}],null,!0)}),1==o.status?e("van-count-down",{attrs:{time:t.time(o)},on:{finish:function(e){return t.finish(o)}},scopedSlots:t._u([{key:"default",fn:function(s){return[e("span",[t._v("剩余时间 ")]),e("span",{staticClass:"block"},[t._v(t._s(s.hours))]),e("span",{staticClass:"colon"},[t._v(":")]),e("span",{staticClass:"block"},[t._v(t._s(s.minutes))]),e("span",{staticClass:"colon"},[t._v(":")]),e("span",{staticClass:"block"},[t._v(t._s(s.seconds))])]}}],null,!0)}):t._e()],1):t._e()])}))],2)})),0)})),1),e("van-action-sheet",{attrs:{"close-on-click-action":""},model:{value:t.show,callback:function(e){t.show=e},expression:"show"}},[e("template",{slot:"default"},[e("div",{staticStyle:{padding:"10px"}},[e("van-field",{staticStyle:{"border-radius":"16px"},attrs:{rows:"4",autosize:"",label:"取消理由",type:"textarea",maxlength:"60",placeholder:"请输入理由","show-word-limit":""},model:{value:t.reason,callback:function(e){t.reason=e},expression:"reason"}}),e("van-button",{staticStyle:{float:"right","margin-bottom":"10px"},attrs:{type:"primary"},on:{click:function(e){return t.cancel()}}},[t._v("提交")])],1)])],2)],1)},r=[],a=(s(16743),s(88848)),n=(s(57658),s(7877)),i={name:"order",inject:["reload"],data:function(){return{active:0,searchValue:"",orders:[],load:!1,reason:"",show:!1,i:"",orderId:""}},created:function(){console.log(this.$route.query.status);let t=parseInt(this.$route.query.status)+1;this.getOrder(t),this.active=t},methods:{orderTitle(t){let e=["全部","待付款","待发货","待收货","待评价","已评价"];return e[t-1]},orderStatus(t){let e=["等待买家付款","买家已付款","卖家已发货","交易成功","退款/售后"];return-1==t.status?"已评价":-2==t.status?"超时自动取消"==t.etc.cancelReason?"超时取消":"交易关闭":e[t.status-1]},userAction(t){let e=["继续付款","催发货","确认收货","评价"];return-1==t?"追评":e[t-1]},finish(t){(0,a.Z)("订单"+t.etc.no+"超时自动取消"),this.getOrder(1),this.reload()},back(){this.$router.push({path:"/frontUser"})},change(t){this.getOrder(t),this.$router.push({path:"/order",query:{status:6==t?-1:t-1}})},time(t){return console.log(t.etc.cancelTime,"取消时间"),t.etc.cancelTime-Date.now()},cancelOrder(t,e){event.stopPropagation(),this.show=!0,this.orderId=t,this.i=e,console.log(e)},cancel(){let t=this;n.Z.cancelOrder("/order/cancel",this.orderId,this.reason).then((e=>{console.log(e),(0,a.Z)("取消成功"),t.show=!1,t.getOrder(t.i-1)}))},deleteOrderDetail(t){event.stopPropagation();let e=this;this.$dialog.confirm({title:"删除订单",message:"是否继续？"}).then((()=>{n.Z.deleteOrderDetail("/orderDetail/deleteByIds",t.orderId,t.bookId).then((t=>{console.log("删除订单",t.data),(0,a.Z)("删除成功"),e.getOrder(1)}))})).catch((()=>{}))},action(t,e){if(event.stopPropagation(),console.log(e),2!=e){let s=this;this.$dialog.confirm({title:this.userAction(e),message:"是否继续？"}).then((()=>{4==e||-1==e?s.$router.push({path:"/comment",query:{book:t}}):n.Z.updateOrderDetail("/orderDetail/update",t.orderId,t.bookId,t.status).then((t=>{console.log(t),s.getOrder(e),s.reload()}))})).catch((()=>{}))}},toDetail(t){5==t.status?this.$router.push({path:"/reFund",query:{books:t}}):this.$router.push({path:"/orderDetail",query:{book:t}})},getOrders(t){let e=[];t.forEach((t=>{e.push(t.publisher)})),e=Array.from(new Set(e));let s=[];for(let o=0;o<e.length;o++){s.push({publisher:e[o],books:[]});let r=[];t.forEach((t=>{t.publisher==e[o]&&r.push(t)})),s[o].books=r}return s},getOrder(t){this.active=t,6==t&&(t=0);let e=t-1,s=this;n.Z.getUser("/user/getUser",localStorage.getItem("username")).then((function(t){200==t.statusCode?n.Z.getByUserId("/order/getByUserId").then((t=>{console.log(t.data);let o=[];t.data.forEach((t=>{o.push(t.id)})),console.log(o),n.Z.getDetail("/orderDetail/getDetail",o.join(","),e).then((t=>{if(200==t.statusCode){console.log(t.data);let e=[],o=[];o=t.data;let r=[];o.forEach((t=>{r.push(t.bookId)})),n.Z.getCartBookByIds("/book/getBookByIds",r.join(",")).then((function(t){console.log(t.data),e=o.map(((e,s)=>({...t.data[s],...e}))),console.log(e),s.orders=s.getOrders(e),console.log(s.orders)}))}}))})):401==t.statusCode&&((0,a.Z)("token过期"),s.$router.push("login"))}))}}},l=i,c=s(43736),u=(0,c.Z)(l,o,r,!1,null,"722907a7",null),d=u.exports}}]);
//# sourceMappingURL=111.e12ff2d3.js.map