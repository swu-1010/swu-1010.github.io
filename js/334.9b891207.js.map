{"version":3,"file":"js/334.9b891207.js","mappings":"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","sources":["webpack://bookstore_app/./src/components/mobile/ConfirmOrder.vue","webpack://bookstore_app/src/components/mobile/ConfirmOrder.vue","webpack://bookstore_app/./src/components/mobile/ConfirmOrder.vue?7606","webpack://bookstore_app/./src/components/mobile/ConfirmOrder.vue?4f95"],"sourcesContent":["var render = function render(){var _vm=this,_c=_vm._self._c;return _c('div',{staticClass:\"ConfirmOrder\"},[_c('van-nav-bar',{attrs:{\"left-text\":\"确认订单\",\"left-arrow\":\"\"},on:{\"click-left\":function($event){return _vm.$router.go(-1)}}}),_c('van-address-list',{staticStyle:{\"padding\":\"0px\"},attrs:{\"list\":_vm.list,\"default-tag-text\":\"默认\"},on:{\"click-item\":function($event){return _vm.onAdd()}}}),_vm._l((_vm.carts),function(publisher,indexP){return _c('div',{key:indexP,staticStyle:{\"text-align\":\"left\"}},[_c('div',{staticClass:\"publish\"},[_c('nav',[_vm._v(_vm._s(publisher.publisher))])]),_vm._l((publisher.books),function(book,indexB){return _c('van-card',{key:indexB,attrs:{\"num\":book.num,\"price\":book.price,\"desc\":book.author,\"title\":book.name,\"thumb\":'/' + book.img}})})],2)}),_c('van-action-sheet',{attrs:{\"close-on-click-action\":\"\"},model:{value:(_vm.show),callback:function ($$v) {_vm.show=$$v},expression:\"show\"}},[_c('template',{slot:\"default\"},[_c('van-address-edit',{attrs:{\"address-info\":_vm.address,\"area-list\":_vm.areaList,\"show-delete\":\"\",\"area-columns-placeholder\":['请选择', '请选择', '请选择']},on:{\"save\":_vm.onSave,\"delete\":_vm.onDelete}})],1)],2),_c('van-submit-bar',{attrs:{\"suffix-label\":_vm.totalNum,\"price\":parseInt(_vm.$route.query.totalPrice),\"button-text\":\"提交订单\"},on:{\"submit\":_vm.submit}})],2)\n}\nvar staticRenderFns = []\n\nexport { render, staticRenderFns }","<template>\r\n    <div class=\"ConfirmOrder\">\r\n        <van-nav-bar left-text=\"确认订单\" left-arrow @click-left=$router.go(-1) />\r\n        <!-- <van-contact-card :type=\"addressType\" add-text=\"添加收货地址\" :name=\"user.username\" :tel=\"user.telephone\" @click=\"onAdd\" >\r\n        </van-contact-card> -->\r\n        <van-address-list :list=\"list\" style=\"padding: 0px\" @click-item=\"onAdd()\" default-tag-text=\"默认\" />\r\n        <div v-for=\"publisher,indexP in carts\" :key=\"indexP\" style=\"text-align: left;\">\r\n            <div class=\"publish\">\r\n                <nav >{{publisher.publisher}}</nav>\r\n            </div>\r\n            <van-card v-for=\"book,indexB in publisher.books\" :num=\"book.num\" :key=\"indexB\" :price=\"book.price\" :desc=\"book.author\"\r\n                :title=\"book.name\" :thumb=\"'/' + book.img\" >\r\n            \r\n            </van-card>\r\n        </div>\r\n        <van-action-sheet v-model=\"show\" close-on-click-action>\r\n            <template slot=\"default\">\r\n                <van-address-edit :address-info=\"address\" :area-list=\"areaList\" show-delete\r\n                   :area-columns-placeholder=\"['请选择', '请选择', '请选择']\" @save=\"onSave\" @delete=\"onDelete\" />\r\n            </template>\r\n        </van-action-sheet>\r\n        <van-submit-bar :suffix-label=\"totalNum\" :price=\"parseInt($route.query.totalPrice)\" button-text=\"提交订单\" @submit=\"submit\">\r\n            \r\n        </van-submit-bar>\r\n    </div>\r\n</template>\r\n\r\n<script>\r\nimport api from \"@/api\"\r\nimport { Toast } from \"vant\";\r\nimport { areaList } from '@vant/area-data';\r\n\r\nexport default {\r\n    name: 'confirmOrder',\r\n    data: function () {\r\n        return {\r\n            books: [],\r\n            carts: [],\r\n            user: {},\r\n            show: false,\r\n            areaList: areaList,\r\n            searchResult: [],\r\n            address: {},\r\n            list: [],\r\n        }\r\n    },\r\n    methods: {\r\n        getUser() {\r\n            let self = this;\r\n            api.getUser(\"/user/getUser\", localStorage.getItem('username'))\r\n                .then(function (res) {\r\n                    console.log(res.data);\r\n                    self.user = res.data.user;\r\n                    self.list = [];\r\n                    self.list.push({name: self.user.username, tel: self.user.telephone, address: self.user.address});\r\n                })\r\n        },\r\n        onEdit() {\r\n            this.$router.push('address');\r\n        },\r\n        submit() {\r\n            // this.$route.query.totalPrice\r\n            let bookIds = [];\r\n            let numIds = [];\r\n            this.carts.forEach(cart => {\r\n                cart.books.forEach(book => {\r\n                    bookIds.push(book.bookId);\r\n                    numIds.push(book.num);\r\n                })\r\n            })\r\n            console.log(bookIds.join(\",\"));\r\n            console.log(numIds.join(\",\"));\r\n            let self = this;\r\n            this.$dialog.confirm({\r\n                title: '订单结算',\r\n                message: '是否付款',\r\n            })\r\n                .then(() => {\r\n                    // on confirm\r\n                    api.addOrder(\"/order/add\", this.$route.query.totalPrice / 100, 1)\r\n                        .then(res => {\r\n                            console.log(res.data);\r\n                            let data = {\r\n                                orderId: res.data.id,\r\n                                status: 2,\r\n                                ids: bookIds.join(\",\"),\r\n                                nums: numIds.join(\",\"),\r\n                            }\r\n                            api.addOrderDetail(\"/orderDetail/add\", data)\r\n                                .then(res1 => {\r\n                                    console.log(res1.data);\r\n                                    api.deleteByIds(\"/cart/deleteByIds\", bookIds.join(\",\"))\r\n                                        .then(res2 => {\r\n                                            console.log(res2.data);\r\n                                            Toast(\"成功\");\r\n                                            self.$router.push({ path: '/order', query: { status: 2 } });\r\n                                        })\r\n                                })\r\n                        })\r\n                })\r\n                .catch(() => {\r\n                    // on cancel\r\n                    api.addOrder(\"/order/add\", this.$route.query.totalPrice / 100, 0)\r\n                        .then(res => {\r\n                            console.log(res.data);\r\n                            let data = {\r\n                                orderId: res.data.id,\r\n                                status: 1,\r\n                                ids: bookIds.join(\",\"),\r\n                                nums: numIds.join(\",\"),\r\n                            }\r\n                            api.addOrderDetail(\"/orderDetail/add\", data)\r\n                                .then(res1 => {\r\n                                    console.log(res1.data);\r\n                                    api.deleteByIds(\"/cart/deleteByIds\", bookIds.join(\",\"))\r\n                                        .then(res2 => {\r\n                                            console.log(res2.data);\r\n                                            Toast(\"成功\");\r\n                                            self.$store.commit('setCartNum')\r\n                                            self.$router.push({ path: '/order', query: { status: 1 } });\r\n                                        })\r\n                                })\r\n                        })\r\n                });\r\n        },\r\n        onAdd() {\r\n            this.show = true;\r\n            this.address = {name: this.user.username, tel: this.user.telephone};\r\n        },\r\n        onSave(myAddress) {\r\n            console.log(myAddress);\r\n            let address = myAddress.province + myAddress.city + myAddress.county + \" \" + myAddress.addressDetail;\r\n            \r\n            var data = {\r\n                'telephone': myAddress.tel,\r\n                'address': address\r\n            }\r\n            let self = this;\r\n            api.updateUser(\"/user/updateUser\", data)\r\n                .then(function(res) {\r\n                    console.log(res.data.data);\r\n                    self.user = res.data.data;\r\n                    self.show = false;\r\n                    self.getUser();\r\n                })\r\n        },\r\n        onDelete(myAddress) {\r\n            myAddress.tel = '';\r\n            myAddress.province = '';\r\n            myAddress.name = '';\r\n            myAddress.county = '';\r\n            myAddress.city = '';\r\n            myAddress.areaCode = '';\r\n            myAddress.addressDetail = '';\r\n        }\r\n    },\r\n    created: function() {\r\n        this.carts = this.$route.query.books;\r\n        // console.log(this.$route.query.totalPrice);\r\n\r\n        this.getUser();\r\n    },\r\n    computed:  {\r\n        totalNum: function() {\r\n            let num = 0;\r\n            this.books.forEach(i => {\r\n                num += i.num;\r\n            })\r\n            return num > 0 ? '共'+num+'件': '';\r\n        },\r\n    }\r\n\r\n}\r\n</script>\r\n\r\n<style scoped>\r\n\r\n.van-nav-bar .van-icon {\r\n    color: black !important;\r\n}\r\n.van-nav-bar__text {\r\n    color: black !important;\r\n}\r\n.publish {\r\n    margin-left: 15px;\r\n    padding: 10px;\r\n}\r\n\r\n.van-address-list__bottom {\r\n    display: none;\r\n}\r\n.van-address-edit__buttons {\r\n    padding: 0px;\r\n}\r\n</style>","import mod from \"-!../../../node_modules/thread-loader/dist/cjs.js!../../../node_modules/babel-loader/lib/index.js??clonedRuleSet-40.use[1]!../../../node_modules/@vue/cli-service/node_modules/@vue/vue-loader-v15/lib/index.js??vue-loader-options!./ConfirmOrder.vue?vue&type=script&lang=js&\"; export default mod; export * from \"-!../../../node_modules/thread-loader/dist/cjs.js!../../../node_modules/babel-loader/lib/index.js??clonedRuleSet-40.use[1]!../../../node_modules/@vue/cli-service/node_modules/@vue/vue-loader-v15/lib/index.js??vue-loader-options!./ConfirmOrder.vue?vue&type=script&lang=js&\"","import { render, staticRenderFns } from \"./ConfirmOrder.vue?vue&type=template&id=60d05aad&scoped=true&\"\nimport script from \"./ConfirmOrder.vue?vue&type=script&lang=js&\"\nexport * from \"./ConfirmOrder.vue?vue&type=script&lang=js&\"\nimport style0 from \"./ConfirmOrder.vue?vue&type=style&index=0&id=60d05aad&prod&scoped=true&lang=css&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../../node_modules/@vue/cli-service/node_modules/@vue/vue-loader-v15/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  \"60d05aad\",\n  null\n  \n)\n\nexport default component.exports"],"names":["render","_vm","this","_c","_self","staticClass","attrs","on","$event","$router","go","staticStyle","list","onAdd","_l","carts","publisher","indexP","key","_v","_s","books","book","indexB","num","price","author","name","img","model","value","show","callback","$$v","expression","slot","address","areaList","onSave","onDelete","totalNum","parseInt","$route","query","totalPrice","submit","staticRenderFns","data","user","searchResult","methods","getUser","api","then","console","self","tel","onEdit","cart","bookIds","numIds","title","message","orderId","status","ids","nums","path","catch","myAddress","created","computed","component"],"sourceRoot":""}